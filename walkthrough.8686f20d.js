import"./edit.446baefd.js";import"./Questionary-builder-final.2a43680d.js";function e(e,t,r,u){Object.defineProperty(e,t,{get:r,set:u,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},u={},a=t.parcelRequired7c6;null==a&&((a=function(e){if(e in r)return r[e].exports;if(e in u){var t=u[e];delete u[e];var a={id:e,exports:{}};return r[e]=a,t.call(a.exports,a,a.exports),a.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){u[e]=t},t.parcelRequired7c6=a);var n=a.register;n("7ftR3",function(t,r){e(t.exports,"loadAnswersToQuestions",function(){return n});var u=a("nuyhG");let n=async e=>{let{data:t,error:r}=await (0,u.supabase).from("answers").select("question_id,answer, id, is_right").eq("question_id",e);if(r)throw Error(r.message);return t}}),n("e2YgP",function(t,r){e(t.exports,"loadQuestionsToTest",function(){return n});var u=a("nuyhG");let n=async e=>{let{data:t,error:r}=await (0,u.supabase).from("questions").select("*").eq("test_id",e).order("order",{ascending:!0});if(r)throw Error(r.message);return t}});var s=a("7ftR3"),i=a("e2YgP"),l=a("jMsY1"),o=a("nuyhG");let d=async e=>{let{data:t,error:r}=await (0,o.supabase).from("answers").select("question_id, answer, is_right").eq("question_id",e);if(r)throw Error(r.message);return t.filter(e=>"true"===e.is_right||e.is_right===e.answer).map(e=>e.answer.trim().toLowerCase())},c=async e=>{let{data:t,error:r}=await (0,o.supabase).from("tests").update({completed:e[0].completed+1}).eq("id",e[0].id);r&&console.error("Error updating completions:",r)},m=async e=>{let t=0,r=0;for(let u of e){let e=await d(u.questionId);if(e.length>0){let a=u.answers?u.answers.map(e=>e.trim().toLowerCase()):[u.answer.trim().toLowerCase()];r+=e.length;let n=a.filter(t=>e.includes(t));n.length===e.length&&n.length===a.length&&(t+=e.length)}}return{grade:t/r*100,correctAnswersCount:t,totalCorrectAnswers:r}};var o=a("nuyhG");let w=async e=>{let{data:t,error:r}=await (0,o.supabase).from("test_attempts").insert([{test_id:e,created_at:new Date}]).select();return r?(console.error("Error starting test attempt:",r),null):t[0]},f=async(e,t)=>{let r=Math.round((Date.now()-t)/1e3),{error:u}=await (0,o.supabase).from("test_attempts").update({completed_at:new Date,duration:r}).eq("id",e);u&&console.error("Error completing test attempt:",u)},p=async(e,t,r=null)=>{let{error:u}=await (0,o.supabase).from("question_answers").insert([{attempt_id:e,question_id:t,answer_id:r}]);u&&console.error("Ошибка сохранения ответа:",u)};var o=a("nuyhG"),h=a("kcAQ0");async function g(e){if(!e)return console.error("Помилка: testId обов'язковий!"),null;let{data:t,error:r}=await (0,o.supabase).from("question_answers").select("question_id, answer_id, questions!inner(test_id)").eq("questions.test_id",e);if(r)return console.error("Помилка отримання данних:",r),null;let u={};return t.forEach(({question_id:e,answer_id:t})=>{let r=`${e}-${t}`;u[r]=(u[r]||0)+1}),Object.entries(u).map(([t,r])=>{let[u,a]=t.split("-");return{testId:e,questionId:u,answerId:a,count:r}})}async function b(e){if(!e)return console.error("Помилка: testId обов'язковий!"),null;let{data:t,error:r}=await (0,o.supabase).from("test_attempts").select("started_at, completed_at").eq("test_id",e).not("completed_at","is",null);if(r)return console.error("Помилка при отриманні данних:",r),null;let u=t.map(e=>(new Date(e.completed_at)-new Date(e.started_at))/1e3),a=u.reduce((e,t)=>e+t,0)/u.length;return(0,h.default)(a.toFixed(1))}let y=async e=>{let{data:t,error:r}=await (0,o.supabase).from("answers").select("answer").eq("id",e);if(r)throw Error(r.message);return t[0].answer},q=null,_=null;!async function(){let e=0,t=new URLSearchParams(document.location.search).get("test_id");if(!t)return window.location.replace("/");let r=await (0,l.loadTest)(t);if(0===r.length){document.title="Нічого не знайдено",document.querySelector(".container").innerHTML=`
      <div>
        <a class="rollback" href="/">\u{41F}\u{43E}\u{432}\u{435}\u{440}\u{43D}\u{443}\u{442}\u{438}\u{441}\u{44F} \u{43D}\u{430}\u{437}\u{430}\u{434}</a>
        <h1>\u{41D}\u{430} \u{436}\u{430}\u{43B}\u{44C} \u{442}\u{430}\u{43A}\u{43E}\u{433}\u{43E} \u{442}\u{435}\u{441}\u{442}\u{443} \u{449}\u{435} \u{43D}\u{435} \u{456}\u{441}\u{43D}\u{443}\u{454} \u{1F437}</h1>
      </div>
    `;return}_=Date.now();let u=await w(r[0].id);u&&(q=u.id),document.title=r[0].title;let a=await (0,i.loadQuestionsToTest)(t),n=await Promise.all(a.map(async e=>await (0,s.loadAnswersToQuestions)(e.id))),o={},d=()=>{let e=a.every(e=>{let t=document.querySelector(`[name="answer-${e.id}"]`);return"text"===e.type?t&&""!==t.value.trim():"single"===e.type?document.querySelector(`[name="answer-${e.id}"]:checked`):"multiple"===e.type&&document.querySelectorAll(`[name="answer-${e.id}[]"]:checked`).length>0});finish.disabled=!e};if(r&&a&&n){document.querySelector(".container").innerHTML=`
      <a class="rollback" href="/">\u{41D}\u{430} \u{433}\u{43E}\u{43B}\u{43E}\u{432}\u{43D}\u{443}</a>
      <h1>${r[0].title}</h1>
      <p class="test-description">${r[0].description}</p>
      <div id="wrapper">
        <button id="prev" disabled><</button>
        <button id="next">></button>
      </div>
      <button id="finish" disabled>\u{417}\u{430}\u{432}\u{435}\u{440}\u{448}\u{438}\u{442}\u{438} \u{442}\u{435}\u{441}\u{442}</button>
    `;let t=document.getElementById("wrapper"),u=await Promise.all(a.map(async e=>`<div class="question-card">
          <h3>${e.question}</h3>
          ${e.image_url?`
              <a data-fslightbox href="${e.image_url}">
                <img draggable="false" data-lightbox="image-1" class="q-image" src="${e.image_url}" alt="${e.question}">
              </a>
              `:""}
        </div>`));t.insertAdjacentHTML("beforeend",u.join("")),refreshFsLightbox();let s=document.querySelectorAll(".question-card");a.map(e=>{let t=n.flat().filter(t=>t.question_id===e.id),r="";switch(e.type){case"text":r=`<input type="text" name="answer-${e.id}" class="text-answer" placeholder="\u{412}\u{430}\u{448}\u{430} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{44C}:">`;break;case"single":r=t.map(t=>`
            <label>
              <input type="radio" name="answer-${e.id}" value="${t.id}">
              ${t.answer}
            </label>
          `).join("");break;case"multiple":r=t.map(t=>`
            <label>
              <input type="checkbox" name="answer-${e.id}[]" value="${t.id}">
              ${t.answer}
            </label>
          `).join("");break;default:r="<p>Невідомий тип</p>"}return`<div class="answers">${r}</div>`}).forEach((e,t)=>{s[t].insertAdjacentHTML("beforeend",e)});let i=document.getElementById("next"),l=document.getElementById("prev"),w=document.getElementById("finish"),h=()=>{e+1>=a.length?i.setAttribute("disabled",!0):i.removeAttribute("disabled"),e-1<0?l.setAttribute("disabled",!0):l.removeAttribute("disabled")};h();let v=()=>a.map(e=>{if("text"===e.type){let t=document.querySelector(`[name="answer-${e.id}"]`),r=n.find(t=>t[0]?.question_id===e.id)||[];return{questionId:e.id,answer:t?t.value.trim():null,answerId:r.length>0?r[0]?.id:null}}if("single"===e.type){let t=Array.from(document.querySelectorAll(`[name="answer-${e.id}"]`)),r=t.find(e=>e.checked),u=r?t.indexOf(r):null,a=n.find(t=>t[0]?.question_id===e.id)||[];return{questionId:e.id,answer:r?r.parentElement.textContent.trim():null,answerId:null!==u?a[u]?.id:null}}if("multiple"===e.type){let t=Array.from(document.querySelectorAll(`[name="answer-${e.id}[]"]`)),r=t.filter(e=>e.checked),u=n.find(t=>t[0]?.question_id===e.id)||[];return{questionId:e.id,answers:r.map(e=>e.parentElement.textContent.trim()),answerIds:r.map(e=>{let r=t.indexOf(e);return u[r]?.id||null}).filter(e=>null!==e)}}return{questionId:e.id,answer:null,answerId:null}});i.addEventListener("click",()=>{e+1>=a.length||(e++,s.forEach(t=>{t.style.transform=`translateX(${-(100*e)}%)`}),h())}),l.addEventListener("click",()=>{e-1<0||(e--,s.forEach(t=>{t.style.transform=`translateX(${-(100*e)}%)`}),h())}),document.addEventListener("input",e=>{if(e.target.matches('[name^="answer-"]')){let t=e.target.name.split("-")[1];"checkbox"===e.target.type||"radio"===e.target.type?o[t]=e.target.checked?e.target.value:null:o[t]=e.target.value.trim(),d()}}),setTimeout(()=>{d()},1e3),w.addEventListener("click",async()=>{if(!q){console.error("Цієї спроби не знайдено...");return}localStorage.removeItem(`quizAnswers_${r[0].id}`);let e=v(),{grade:u,correctAnswersCount:n,totalCorrectAnswers:s}=await m(e);if(q)for(let t of e)if(Array.isArray(t.answers)&&Array.isArray(t.answerIds))for(let e=0;e<t.answers.length;e++){let r=t.answers[e],u=t.answerIds[e];await p(Number(q),Number(t.questionId),u?Number(u):null,u?null:r)}else t.answer&&await p(Number(q),Number(t.questionId),t.answerId?Number(t.answerId):null,t.answerId?null:t.answer);await f(q,_),await c(r);let i=await g(r[0].id),l=await b(r[0].id);t.innerHTML=`<div id="dashboard">
        <div>
          <h2>\u{412}\u{430}\u{448} \u{440}\u{435}\u{437}\u{443}\u{43B}\u{44C}\u{442}\u{430}\u{442}: ${Math.round(u)}%</h2>
          <p>\u{412}\u{438} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{43B}\u{438} \u{43F}\u{440}\u{430}\u{432}\u{438}\u{43B}\u{44C}\u{43D}\u{43E} \u{43D}\u{430} ${n}/${s} \u{43F}\u{440}\u{430}\u{432}\u{438}\u{43B}\u{44C}\u{43D}\u{438}\u{445} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{435}\u{439}</p>
          <p>\u{421}\u{435}\u{440}\u{435}\u{434}\u{43D}\u{456}\u{439} \u{447}\u{430}\u{441} \u{43F}\u{440}\u{43E}\u{445}\u{43E}\u{434}\u{436}\u{435}\u{43D}\u{43D}\u{44F} \u{446}\u{44C}\u{43E}\u{433}\u{43E} \u{442}\u{435}\u{441}\u{442}\u{443} \u{441}\u{435}\u{440}\u{435}\u{434} \u{456}\u{43D}\u{448}\u{438}\u{445}: ${l}</p>
        </div>
        <div id="questions-list">
          <h3>\u{412}\u{430}\u{448}\u{456} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{456}:</h3>
          <ul>
            ${e.map(e=>{let t=a.find(t=>t.id===e.questionId),r=t?t.question:"Питання не знайдено",u=Array.isArray(e.answers)&&e.answers.length>0?e.answers.join(", "):e.answer||"Без відповіді";return"text"==t.type?`<li>
                          <strong>\u{41F}\u{438}\u{442}\u{430}\u{43D}\u{43D}\u{44F}:</strong> ${r}<br>
                          <strong>\u{412}\u{430}\u{448} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{44C}:</strong> ${u}<br>
                        </li>`:`<li>
                          <strong>\u{41F}\u{438}\u{442}\u{430}\u{43D}\u{43D}\u{44F}:</strong> ${r}<br>
                          <strong>\u{412}\u{430}\u{448} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{44C}:</strong> ${u}<br>
                          <canvas class="pieChart" id="pie-${e.questionId}" width="200" height="200"></canvas>
                        </li>`}).join("")}
          </ul>
        </div>
      </div>`,w.remove(),setTimeout(()=>{e.forEach(async e=>{let t=String(e.questionId),r=i.filter(e=>String(e.questionId)===t);if(0===r.length)return;let u=await Promise.all(r.map(async e=>({label:await y(e.answerId),value:e.count}))),a=u.map(e=>`\u{412}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{44C}: ${e.label}`),n=u.map(e=>e.value),s=u.map(()=>(function(){let e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),r=Math.floor(256*Math.random());return`rgb(${e}, ${t}, ${r})`})()),l=document.getElementById(`pie-${t}`);if(l){let e=l.getContext("2d");e?new Chart(e,{type:"pie",data:{labels:a,datasets:[{label:"Кількість",data:n,backgroundColor:s,hoverOffset:4}]}}):console.error("Не удалось получить контекст для канваса")}else console.error("Не удалось найти канвас для questionId:",t)})},100)})}}();
//# sourceMappingURL=walkthrough.8686f20d.js.map
