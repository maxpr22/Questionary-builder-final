!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},n={},u=t.parcelRequired7c6;null==u&&((u=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var u={id:e,exports:{}};return r[e]=u,t.call(u.exports,u,u.exports),u.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},t.parcelRequired7c6=u),u.register;var i=u("7ZMNl"),a=u("1NkZi");let o=async e=>{let t=`${crypto.randomUUID()}.${e.name.split(".").pop()}`,{error:r}=await (0,i.supabase).storage.from("images").upload(t,e);if(r)throw Error("Помилка завантаження зображення: "+r.message);let{data:n}=(0,i.supabase).storage.from("images").getPublicUrl(t);return n.publicURL},l=async()=>{let t=null;try{let r=document.getElementById("test-title").value.trim(),n=document.getElementById("test-description").value.trim();if(!r||!n)throw Error("Назва і опис тексту не можуть бути пустими!");let u=await Promise.all(Array.from(document.querySelectorAll(".question")).map(async e=>{let t=e.id,r=e.querySelector('input[name="question"]').value.trim(),n=e.querySelector("select").value;if(!r)throw Error("Питання не може бути пустим!");let u=e.querySelector('input[type="file"]').files[0],i=u?await o(u,t):null,a=Array.from(e.querySelectorAll(".answer")).map(e=>{let t=e.querySelector('input[name="answer"]'),r=e.querySelector(".correct-answer")?.checked,u=t.value.trim();if(!u)throw Error("Відповідь не може бути пустою!");return{text:u,correct_answer:"text"===n?u:r?"true":"false"}});if("text"===n&&0===a.length){let t=e.querySelector('input[name="text-answer"]');if(!t)throw Error("Відсутнє поле для вводу відповіді!");let r=t.value.trim();if(!r)throw Error("Відповідь на текстове питання не може бути пустою!");a=[{text:r,correct_answer:r}]}return{id:t,title:r,type:n,imageUrl:i,answers:a}})),{data:l,error:s}=await (0,i.supabase).from("tests").insert([{title:r,description:n,count_questions:u.length,completed:0}]).select();if(s)throw Error(s.message);t=l[0].id;let d=u.map(e=>({test_id:t,question:e.title,type:e.type,image_url:e.imageUrl})),{data:c,error:m}=await (0,i.supabase).from("questions").insert(d).select();if(m)throw Error(m.message);let p=c.flatMap((e,t)=>u[t].answers.map(t=>({question_id:e.id,answer:t.text,is_right:t.correct_answer}))),{error:g}=await (0,i.supabase).from("answers").insert(p);if(g)throw Error(g.message);return e(a).Notify.success("Успішно додано новий тест!"),!0}catch(r){return e(a).Notify.failure(r.message),console.error(r),t&&await (0,i.supabase).from("tests").delete().eq("id",t),!1}};document.addEventListener("DOMContentLoaded",()=>{document.getElementById("add-question-btn").addEventListener("click",d)});let s=0;function d(){s++;let e=`question-${s}`,t=document.createElement("div");t.classList.add("question"),t.setAttribute("id",e),t.setAttribute("draggable",!0),t.innerHTML=`
          <div class="question-header">
              <span class="drag-handle">\u{2630}</span>
              <label><span class="question-title">\u{41F}\u{438}\u{442}\u{430}\u{43D}\u{43D}\u{44F} ${s}:</span> 
                  <input type="text" id="question-title" name="question" placeholder="\u{412}\u{432}\u{435}\u{434}\u{456}\u{442}\u{44C} \u{43F}\u{438}\u{442}\u{430}\u{43D}\u{43D}\u{44F}">
              </label>
              <label>\u{422}\u{438}\u{43F}: 
                  <select id="question-type" onchange="updateAnswerType('${e}', this)">
                      <option value="text">\u{422}\u{435}\u{43A}\u{441}\u{442}</option>
                      <option value="single">\u{41E}\u{434}\u{438}\u{43D} \u{432}\u{430}\u{440}\u{456}\u{430}\u{43D}\u{442}</option>
                      <option value="multiple">\u{41A}\u{456}\u{43B}\u{44C}\u{43A}\u{430} \u{432}\u{430}\u{440}\u{456}\u{430}\u{43D}\u{442}\u{456}\u{432}</option>
                  </select>
              </label>
              <button onclick="removeElement('${e}')">\u{412}\u{438}\u{434}\u{430}\u{43B}\u{438}\u{442}\u{438}</button>
          </div>
  
          <div class="image-upload">
              <input type="file" accept="image/*" onchange="previewImage(event, '${e}')">
              <div class="image-preview" id="${e}-image-preview"></div>
          </div>
  
          <div class="answers" id="${e}-answers"></div>
          <button class="add-answer" onclick="addAnswer('${e}')">\u{414}\u{43E}\u{434}\u{430}\u{442}\u{438} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{44C}</button> 
      `,document.getElementById("questions-container").appendChild(t),t.addEventListener("dragstart",p),t.addEventListener("dragover",g),t.addEventListener("drop",f),t.addEventListener("dragleave",w),t.addEventListener("dragend",v)}function c(){document.querySelectorAll(".question").forEach((e,t)=>{let r=`question-${t+1}`;e.setAttribute("id",r),e.querySelector(".question-title").innerText=`\u{41F}\u{438}\u{442}\u{430}\u{43D}\u{43D}\u{44F} ${t+1}:`,e.querySelector("select").setAttribute("onchange",`updateAnswerType('${r}', this)`),e.querySelector(".answers").setAttribute("id",`${r}-answers`),e.querySelector(".add-answer").setAttribute("onclick",`addAnswer('${r}')`),e.querySelector('button[onclick^="removeElement"]').setAttribute("onclick",`removeElement('${r}')`),e.querySelectorAll(".correct-answer").forEach(e=>{e.name=`correct-${r}`})})}let m=null;function p(e){m=e.target,e.target.classList.add("dragging")}function g(e){e.preventDefault();let t=e.target.closest(".question"),r=document.getElementById("questions-container");if(t&&t!==m&&r.contains(t)){let e=Array.from(r.children);e.indexOf(m)>e.indexOf(t)?r.insertBefore(m,t):r.insertBefore(m,t.nextSibling)}}function f(e){e.preventDefault(),m.classList.remove("dragging")}function w(e){e.target.closest(".question")?.classList.remove("drag-over")}function v(){let e=document.getElementById("questions-container");e.contains(m)||(originalPosition?originalPosition.parentNode.insertBefore(m,originalPosition):e.appendChild(m)),m.classList.remove("dragging"),m=null,c(),document.querySelectorAll(".question").forEach((e,t)=>{let r=`question-${t+1}`;e.setAttribute("data-question-id",r);let n=e.querySelector(".image-wrapper");n&&(n.id=`${r}-image-preview`);let u=e.querySelector(".delete-image");u&&u.setAttribute("onclick",`removeImage('${r}')`)})}document.getElementById("add-test-btn").addEventListener("click",async e=>{e.target.setAttribute("disabled",!0),await l()?setTimeout(()=>{window.location.replace("/")},1e3):e.currentTarget.removeAttribute("disabled")}),window.removeImage=function(e){let t=document.getElementById(e),r=t.querySelector('input[type="file"]');r&&(r.value=null);let n=t.querySelector(".image-preview");n&&(n.innerHTML="")},window.addAnswer=function(e){let t=document.getElementById(`${e}-answers`),r=document.getElementById(e);if(!r)return;let n=r.querySelector("select").value;if("text"===n){if(0===t.children.length){let e=document.createElement("input");e.type="text",e.name="text-answer",e.placeholder="Правильна відповідь",t.appendChild(e)}return}let u=document.createElement("div");u.classList.add("answer"),u.innerHTML=`
      <label>
          <input type="text" name="answer" class="answer-input" placeholder="\u{412}\u{430}\u{440}\u{456}\u{430}\u{43D}\u{442}">
          <input type="${"single"===n?"radio":"checkbox"}" class="correct-answer" name="correct">
          <span>\u{41F}\u{440}\u{430}\u{432}\u{438}\u{43B}\u{44C}\u{43D}\u{430} \u{432}\u{456}\u{434}\u{43F}\u{43E}\u{432}\u{456}\u{434}\u{44C}</span>
      </label>
      <button class="remove-question" onclick="this.parentElement.remove()">\u{412}\u{438}\u{434}\u{430}\u{43B}\u{438}\u{442}\u{438}</button>
  `,t.appendChild(u)},window.updateAnswerType=function(e,t){document.getElementById(`${e}-answers`).innerHTML=""},window.removeElement=function(e){let t=document.getElementById(e);t&&(t.remove(),s--,c())},window.previewImage=function(e,t){let r=e.target.files[0];if(r){let e=new FileReader;e.onload=function(e){document.getElementById(`${t}-image-preview`).innerHTML=`
            <div class="image-wrapper">
              <img src="${e.target.result}" alt="\u{417}\u{43E}\u{431}\u{440}\u{430}\u{436}\u{435}\u{43D}\u{43D}\u{44F}">
              <button class="delete-image" onclick="removeImage('${t}')">\xd7</button>
            </div>
          `},e.readAsDataURL(r)}},d()}();
//# sourceMappingURL=questionary-builder.044c7020.js.map
